{"version":3,"file":"worker.bundle.js","names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","deps","assert","glob","window","self","mod","ok","exp","msg","undefined","JSON","stringify","equal","b"],"mappings":"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","sources":["node_modules/browser-pack/_prelude.js","worker_deps.js","../glov/client/require.js","../glov/client/shims/assert.js","node_modules/browser-pack/_prelude.js(2)","worker.js","../glov/client/filewatch.js","../glov/client/locate_asset.ts","../glov/client/polyfill.js","../glov/client/webfs.js","../glov/client/worker_thread.ts","../glov/common/util.ts"],"sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","/* globals deps */\nrequire('../glov/client/require.js');\n\ndeps.assert = require('assert');\n","/* globals self */\nconst glob = typeof window === 'undefined' ? self : window;\nlet deps = glob.deps = glob.deps || {};\nglob.require = function (mod) {\n  if (!deps[mod]) {\n    throw new Error(`Cannot find module '${mod}' (add it to deps.js or equivalent)`);\n  }\n  return deps[mod];\n};\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nfunction ok(exp, msg) {\n  if (exp) {\n    return;\n  }\n  msg = msg ? msg : (exp === undefined || exp === false) ? '' : JSON.stringify(exp);\n  throw new Error(`Assertion failed${msg ? `: ${msg}` : ''}`);\n}\nmodule.exports = ok;\nmodule.exports.ok = ok;\n\nfunction equal(a, b) {\n  if (a === b) {\n    return;\n  }\n  throw new Error(`Assertion failed: \"${a}\"===\"${b}\"`);\n}\nmodule.exports.equal = equal;\n","(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","\nconst worker = require('glov/client/worker_thread.js');\n\nworker.addHandler('test', function () {\n  console.log('Worker Test!');\n});\n","import assert from 'assert';\nimport { locateAssetDisableHashing } from './locate_asset';\n\nlet by_ext = {};\nlet by_match = [];\n\n// cb(filename)\nexport function filewatchOn(ext_or_search, cb) {\n  if (ext_or_search[0] === '.') {\n    assert(!by_ext[ext_or_search]);\n    by_ext[ext_or_search] = cb;\n  } else {\n    by_match.push([ext_or_search, cb]);\n  }\n}\n\nlet message_cb;\n// cb(message)\nexport function filewatchMessageHandler(cb) {\n  message_cb = cb;\n}\n\nfunction onFileChange(filename) {\n  console.log(`FileWatch change: ${filename}`);\n  locateAssetDisableHashing();\n  let ext_idx = filename.lastIndexOf('.');\n  let did_reload = false;\n  if (ext_idx !== -1) {\n    let ext = filename.slice(ext_idx);\n    if (by_ext[ext]) {\n      if (by_ext[ext](filename) !== false) {\n        did_reload = true;\n      }\n    }\n  }\n  for (let ii = 0; ii < by_match.length; ++ii) {\n    if (filename.match(by_match[ii][0])) {\n      if (by_match[ii][1](filename) !== false) {\n        did_reload = true;\n      }\n    }\n  }\n  if (message_cb && did_reload) {\n    message_cb(`Reloading: ${filename}`);\n  }\n}\n\nexport function filewatchTriggerChange(filename) {\n  onFileChange(filename);\n}\n\nexport function filewatchStartup(client) {\n  client.onMsg('filewatch', onFileChange);\n}\n","/* eslint-env browser */\nimport type { DataObject, TSMap } from 'glov/common/types';\n\nlet asset_mappings = typeof window === 'undefined' ?\n  {} :\n  (window as unknown as DataObject).glov_asset_mappings as TSMap<string>;\nlet asset_dir = asset_mappings && asset_mappings.asset_dir || '';\n\n// Raw LocalStorage access, not using the module, since this is imported\n//   _before_ we've had a chance to set our local storage key.\nlet lsd = (function (): Partial<Record<string, string>> {\n  if (typeof window === 'undefined') {\n    return {};\n  }\n  try {\n    localStorage.setItem('test', 'test');\n    localStorage.removeItem('test');\n    return localStorage;\n  } catch (e) {\n    return {};\n  }\n}());\n\nconst DISABLED_KEY = 'asset_hashing_disabled_until';\nif (Number(lsd[DISABLED_KEY]) > Date.now()) {\n  console.log('Disabling asset mappings due to auto-reload.');\n  asset_mappings = {};\n}\n\nlet proxy_path: string = '';\n// e.g. `.proxy/`\nexport function locateAssetSetProxyPath(proxy_path_in: string): void {\n  proxy_path = proxy_path_in;\n}\n\nlet host_mappings: [string, string][] = [];\nexport function locateAssetAddHostMapping(src: string, dest: string): void {\n  host_mappings.push([src, dest]);\n\n}\n\nexport function locateAsset(name: string): string {\n  if (!asset_mappings) {\n    // shouldn't happen, but this should be safe as a fallback\n    return name;\n  }\n  let m = asset_mappings[name];\n  if (!m) {\n    if (name.includes('://')) {\n      // external/full path\n      for (let ii = 0; ii < host_mappings.length; ++ii) {\n        let pair = host_mappings[ii];\n        if (name.startsWith(pair[0])) {\n          name = pair[1] + name.slice(pair[0].length);\n        }\n      }\n    } else {\n      // internal/relative path\n      if (proxy_path) {\n        return `${proxy_path}${name}`;\n      }\n    }\n    return name;\n  }\n  let ret = `${asset_dir}/${m}`;\n  let idx = name.lastIndexOf('.');\n  if (idx !== -1) {\n    ret += name.slice(idx);\n  }\n  if (proxy_path) {\n    ret = `${proxy_path}${ret}`;\n  }\n  return ret;\n}\n\n// Called in development before doing any reloads (as we don't reload asset_mappings)\nexport function locateAssetDisableHashing(): void {\n  asset_mappings = {};\n  // Also, if a reload is triggered after this, disable asset hashing in that\n  //   session, as the reload happens _before_ the new assets.js is written out.\n  lsd[DISABLED_KEY] = String(Date.now() + 5000);\n}\n\nexport function unlocatePaths(s: string | null | undefined): string {\n  let reverse_lookup = Object.create(null);\n  for (let key in asset_mappings) {\n    reverse_lookup[asset_mappings[key]!] = key;\n  }\n  return String(s).replace(new RegExp(`${asset_dir}/([a-zA-Z0-9]+)\\\\.\\\\w+`, 'g'), function (match, hash) {\n    let m = reverse_lookup[hash];\n    return m || match;\n  });\n}\n","/* eslint no-extend-native:off */\n\n// TypedArray.slice, fill, join, sort, etc - not supported on IE, some older Safari, older Android, Chrome 44\nlet typedarrays = [Int8Array, Uint8Array, Int16Array, Uint16Array, Int32Array, Uint32Array, Float32Array];\n\nif (!Uint8Array.prototype.slice) {\n  typedarrays.forEach(function (ArrayType) {\n    Object.defineProperty(ArrayType.prototype, 'slice', {\n      value: function (begin, end) {\n        if (end === undefined) {\n          end = this.length;\n        }\n        if (end < 0) {\n          end = this.length - end;\n        }\n        begin = begin || 0;\n        if (begin >= this.length) {\n          begin = this.length - 1;\n        }\n        if (end > this.length) {\n          end = this.length;\n        }\n        if (end < begin) {\n          end = begin;\n        }\n        let len = end - begin;\n        let ret = new ArrayType(len);\n        for (let ii = 0; ii < len; ++ii) {\n          ret[ii] = this[begin + ii];\n        }\n        return ret;\n      }\n    });\n  });\n}\n\nfunction cmpDefault(a, b) {\n  return a - b;\n}\nlet replacements = {\n  join: function (delim) {\n    return Array.prototype.join.call(this, delim);\n  },\n  fill: function (value, begin, end) {\n    if (end === undefined) {\n      end = this.length;\n    }\n    for (let ii = begin || 0; ii < end; ++ii) {\n      this[ii] = value;\n    }\n    return this;\n  },\n  sort: function (cmp) {\n    Array.prototype.sort.call(this, cmp || cmpDefault);\n  },\n};\n\nfor (let key in replacements) {\n  if (!Uint8Array.prototype[key]) {\n    typedarrays.forEach(function (ArrayType) {\n      Object.defineProperty(ArrayType.prototype, key, {\n        value: replacements[key],\n      });\n    });\n  }\n}\n\nif (!String.prototype.endsWith) {\n  Object.defineProperty(String.prototype, 'endsWith', {\n    value: function (test) {\n      return this.slice(-test.length) === test;\n    },\n  });\n  Object.defineProperty(String.prototype, 'startsWith', {\n    value: function (test) {\n      return this.slice(0, test.length) === test;\n    },\n  });\n}\nif (!String.prototype.includes) {\n  Object.defineProperty(String.prototype, 'includes', {\n    value: function (search, start) {\n      return this.indexOf(search, start) !== -1;\n    },\n    configurable: true, // FRVR SDK polyfill overrides this :(\n  });\n}\n\nif (!Array.prototype.includes) {\n  Object.defineProperty(Array.prototype, 'includes', {\n    value: function (search, start) {\n      start = start === undefined ? 0 : start < 0 ? this.length + start : start;\n      for (let ii = start; ii < this.length; ++ii) {\n        if (this[ii] === search) {\n          return true;\n        }\n      }\n      return false;\n    },\n    // Doesn't handle `Array(1).includes()==true` expected in frvr-sdk.ie.min.js\n    // value: function (search, start) {\n    //   return this.indexOf(search, start) !== -1;\n    // },\n  });\n}\n\nif (!Object.values) {\n  Object.values = function values(obj) {\n    return Object.keys(obj).map((k) => obj[k]);\n  };\n}\nif (!Object.entries) {\n  Object.entries = function entries(obj) {\n    let keys = Object.keys(obj);\n    let ret = new Array(keys.length);\n    for (let ii = keys.length - 1; ii >= 0; --ii) {\n      ret[ii] = [keys[ii], obj[keys[ii]]];\n    }\n    return ret;\n  };\n}\n// if (!Object.fromEntries) { // For FRVR SDK\n//   Object.fromEntries = function (iterable) {\n//     let keys = Object.keys(iterable);\n//     let obj = {};\n//     for (let ii = 0; ii < keys.length; ++ii) {\n//       let pair = iterable[keys[ii]];\n//       obj[pair[0]] = pair[1];\n//     }\n//     return obj;\n//   };\n//   Object.fromEntries.is_polyfill = true;\n// }\n\nif (!Object.assign) {\n  Object.assign = function assign(target, source1) {\n    for (let argindex = 1; argindex < arguments.length; ++argindex) {\n      // eslint-disable-next-line prefer-rest-params\n      let source = arguments[argindex];\n      for (let key in source) {\n        target[key] = source[key];\n      }\n    }\n    return target;\n  };\n}\n\nif (!Math.sign) {\n  Math.sign = function sign(a) {\n    return a < 0 ? -1 : a > 0 ? 1 : 0;\n  };\n}\n\nif (typeof window !== 'undefined') {\n  if (!window.Intl) {\n    window.Intl = {};\n  }\n  if (!window.Intl.NumberFormat) {\n    window.Intl.NumberFormat = function () {\n      // Constructor\n    };\n    window.Intl.NumberFormat.prototype.format = function (v) {\n      return String(v);\n    };\n  }\n  if (!window.Intl.DateTimeFormat) {\n    window.Intl.DateTimeFormat = function () {\n      // Constructor\n    };\n    window.Intl.DateTimeFormat.prototype.format = function (v) {\n      return String(v);\n    };\n  }\n}\n","import assert from 'assert';\nimport {\n  callEach,\n  clone,\n  deepEqual,\n} from 'glov/common/util';\nimport {\n  filewatchOn,\n  filewatchTriggerChange,\n} from './filewatch';\n\nlet fs;\nlet decoded = {};\nlet used = {};\nlet active_reload = false; // after an active reload, do data cloning to better detect which files changed\n// export function webFSReady() {\n//   // TODO: async ready state?\n// }\n\nlet on_ready = [];\n// Will always be synchronous in the main thread, may be async in the WebWorker\nexport function webFSOnReady(cb) {\n  if (fs) {\n    cb();\n  } else {\n    on_ready.push(cb);\n  }\n}\n\nfunction decode(data) {\n  let len = data[0];\n  let str = data[1];\n  let u8 = new Uint8Array(len);\n  let idxo = 0;\n  let idxi = 0;\n  while (idxo < len) {\n    let byte = str.charCodeAt(idxi++);\n    if (byte === 126) {\n      byte = 0;\n    } else if (byte === 27) {\n      byte = str.charCodeAt(idxi++);\n    }\n    u8[idxo++] = byte;\n  }\n  assert.equal(idxi, str.length);\n  assert.equal(idxo, len);\n  return u8;\n}\n\nexport function webFSGetFileNames(directory) {\n  assert(fs);\n  let ret = [];\n  for (let filename in fs) {\n    if (filename.startsWith(directory)) {\n      ret.push(filename);\n    }\n  }\n  return ret;\n}\n\nexport function webFSGetFile(filename, encoding) {\n  assert(fs);\n  let ret = decoded[filename];\n  if (ret) {\n    return ret;\n  }\n  used[filename] = true;\n  let data = fs[filename];\n  assert(data, `Error loading file: ${filename}`);\n  if (encoding === 'jsobj') {\n    assert(!Array.isArray(data) || !(data.length === 2 && typeof data[0] === 'number' && typeof data[1] === 'string'));\n    ret = active_reload ? clone(data) : data;\n  } else {\n    assert(Array.isArray(data));\n    if (encoding === 'text') {\n      ret = data[1];\n    } else {\n      ret = decode(data);\n    }\n  }\n  decoded[filename] = ret;\n  return ret;\n}\n\nexport function webFSExists(filename) {\n  assert(fs);\n  return Boolean(fs[filename]);\n}\n\nexport function webFSReportUnused(ignore_regex) {\n  // Don't report on files we know are loaded dynamically, and are small\n  ignore_regex = ignore_regex || /\\.(fp|vp)$/;\n  let tot_size = 0;\n  for (let filename in fs) {\n    if (!used[filename] && !filename.match(ignore_regex)) {\n      console.warn(`WebFS file bundled but unreferenced: ${filename}`);\n      tot_size += fs[filename][0];\n    }\n  }\n  if (tot_size) {\n    console.warn(`WebFS wasting ${tot_size} bytes`);\n  }\n}\n\nlet webfs_to_worker_cb;\nexport function webFSSetToWorkerCB(cb) {\n  webfs_to_worker_cb = cb;\n}\nexport function webFSGetData() {\n  return fs;\n}\n\nexport function webFSApplyReload(fs_in) {\n  let old_fs = fs;\n  fs = fs_in;\n\n  // First, send to worker(s), before any changes might be triggered\n  if (webfs_to_worker_cb) {\n    webfs_to_worker_cb(fs);\n  }\n\n  // Then, reload and fire changes\n  decoded = {};\n  used = {};\n  for (let key in fs) {\n    let old_value = old_fs[key];\n    let new_value = fs[key];\n    if (Array.isArray(old_value)) {\n      for (let ii = 0; ii < new_value.length; ++ii) {\n        if (!old_value || new_value[ii] !== old_value[ii]) {\n          filewatchTriggerChange(key);\n          break;\n        }\n      }\n    } else {\n      // Raw object\n      if (!deepEqual(old_value, new_value)) {\n        filewatchTriggerChange(key);\n      }\n    }\n  }\n  // Detect deleted files (especially e.g. a texture changing size to be large enough not to embed anymore!)\n  for (let key in old_fs) {\n    if (!fs[key]) {\n      filewatchTriggerChange(key);\n    }\n  }\n}\n\nlet base_url_for_reload;\nfunction webFSReload() {\n  // Note: only called in main thread, not in workers\n  active_reload = true;\n  window.glov_webfs = null;\n  let scriptTag = document.createElement('script');\n  scriptTag.src = `${base_url_for_reload}fsdata.js?rl=${Date.now()}`;\n  scriptTag.onload = function () {\n    if (window.glov_webfs) {\n      webFSApplyReload(window.glov_webfs);\n    }\n  };\n  document.head.appendChild(scriptTag);\n}\n\nexport function webFSStartup(fs_in, base_url_for_reload_in) {\n  fs = fs_in || {};\n  if (base_url_for_reload_in) {\n    base_url_for_reload = base_url_for_reload_in;\n    filewatchOn('fsdata.js', webFSReload);\n  }\n  if (webfs_to_worker_cb) {\n    webfs_to_worker_cb(fs);\n  }\n  callEach(on_ready, on_ready = null);\n}\n\nexport function webFSAPI() {\n  return {\n    getFileNames: webFSGetFileNames,\n    getFile: webFSGetFile,\n    filewatchOn: filewatchOn,\n  };\n}\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n/* eslint-env browser */\n/* globals Console, Transferable */\n\nrequire('./polyfill.js');\n\nif (!self.profilerStart) {\n  self.profilerStart = self.profilerStop = self.profilerStopStart = function () {\n    // no profiling in the worker thread\n  };\n}\n\nimport assert from 'assert';\nimport {\n  webFSApplyReload,\n  webFSGetData,\n  webFSStartup,\n} from './webfs';\n\nimport type { TSMap } from 'glov/common/types';\n\nexport function sendmsg<T=unknown>(id: string, data: T, transfer?: Transferable[]): void {\n  (postMessage as (message: unknown, transfer?: Transferable[]) => void)({ id, data }, transfer);\n}\n\nexport function debugmsg(msg: string, clear?: boolean): void {\n  sendmsg('debugmsg', { msg, clear });\n}\n\nfunction consoleLogForward(...args: unknown[]): void {\n  sendmsg('log', args.join(' '));\n}\n\nif (!self.console) {\n  self.console = {\n    log: consoleLogForward,\n    info: consoleLogForward,\n    warn: consoleLogForward,\n    error: consoleLogForward,\n  } as Console;\n}\n\n// Catch errors not happening inside handlers' try/catch\nself.addEventListener('error', function (evt) {\n  if (evt.error) {\n    // Manually \"cloning\" the Error object, because it's toJSON (or some other\n    //   serialization logic) strips the relevant bits on MacOS Safari.\n    // Just send the fields we need for bootstrap.js's handling\n    sendmsg('error', {\n      message: evt.error.message,\n      stack: evt.error.stack,\n    });\n    evt.preventDefault();\n  }\n});\n\nexport type WorkerReqHandler<T=unknown> = (payload: T) => void;\n\nlet handlers: TSMap<WorkerReqHandler> = {};\nexport function addHandler<T>(id: string, cb: WorkerReqHandler<T>): void {\n  assert(!handlers[id]);\n  handlers[id] = cb as WorkerReqHandler;\n}\n\nlet time_work = 0;\nlet time_idle = 0;\nlet batch_timing: number[] = [];\nlet last_report_time = Date.now();\nlet timing_enabled = false;\n\nfunction reportTiming(now: number): void {\n  // end work, start yield/idle\n  if (now - last_report_time > 100) {\n    let elapsed = time_work + time_idle;\n    assert(elapsed <= now - last_report_time + 10); // this happened once, why?\n    sendmsg('timing', { time_work, time_idle, elapsed, batches: batch_timing });\n    last_report_time = now;\n    time_idle = time_work = 0;\n    batch_timing.length = 0;\n  }\n}\n\nlet last_work_end = last_report_time;\nlet last_work_start = 0;\nexport function startWork(): void {\n  let now = Date.now();\n  let idle_time = now - last_work_end;\n  if (timing_enabled) {\n    batch_timing.push(idle_time);\n  }\n  time_idle += idle_time;\n  last_work_start = now;\n}\n\nexport function endWork(): void {\n  let now = Date.now();\n  last_work_end = now;\n  let batch_time = now - last_work_start;\n  time_work += batch_time;\n  if (timing_enabled) {\n    batch_timing.push(batch_time);\n    reportTiming(now);\n  }\n}\n\ntype MyWorkerMessage = {\n  id: string;\n  data: unknown;\n};\n\nfunction isMyWorkerMessage(evt: unknown): evt is MyWorkerMessage {\n  return Boolean(evt instanceof Object && (evt as MyWorkerMessage).id);\n}\n\n\nself.onmessage = function (evt_in: { data: unknown }) {\n  // start work, end yield/idle\n  startWork();\n  let evt = evt_in.data;\n  if (isMyWorkerMessage(evt)) {\n    let handler = handlers[evt.id];\n    assert(handler, evt.id);\n    try {\n      handler(evt.data);\n    } catch (e) {\n      sendmsg('error', { message: (e as Error).message || String(e), stack: (e as Error).stack });\n    }\n  } else {\n    console.log('worker (worker thread) unhandled message', evt);\n  }\n  endWork();\n};\n\naddHandler('busy', function (data: number) {\n  let start = Date.now();\n  let a = 1;\n  let b = 1;\n  while (Date.now() - start < data) {\n    let c = a + b;\n    a = b;\n    b = c;\n  }\n  sendmsg('busy_done', null);\n});\n\naddHandler('timing_enable', function (data: boolean) {\n  timing_enabled = data;\n});\n\naddHandler('webfs_data', function (data) {\n  if (webFSGetData()) {\n    webFSApplyReload(data);\n  } else {\n    webFSStartup(data);\n  }\n});\n\naddHandler('assert_now', function () {\n  assert(false);\n});\n\naddHandler('assert_later', function () {\n  setTimeout(function assertLater() {\n    assert(false);\n  }, 100);\n});\n\naddHandler('crash_now', function () {\n  let obj: { foo: { bar: number } } = null!;\n  obj.foo.bar++;\n});\n\naddHandler('crash_later', function () {\n  setTimeout(function crashLater() {\n    let obj: { foo: { bar: number } } = null!;\n    obj.foo.bar++;\n  }, 100);\n});\n\naddHandler('reject_now', function () {\n  // eslint-disable-next-line no-new\n  new Promise((resolve, reject) => {\n    reject(new Error('client_worker_reject_now'));\n  });\n});\n\nsendmsg('log', 'WebWorker communication initialized');\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\nimport assert from 'assert';\n\nimport type { DataObject, ErrorCallback } from './types';\nimport type { Vec2 } from './vmath';\n\nconst { PI, abs, floor, min, max, random, round, pow, sqrt } = Math;\nconst TWO_PI = PI * 2;\n\nexport const EMAIL_REGEX = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\nexport const VALID_USER_ID_REGEX = /^(?:fb\\$|[a-z0-9])[a-z0-9_]{1,32}$/;\n\nexport function nop(): void {\n  // empty\n}\n\nexport function identity<T>(a: T): T {\n  return a;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function once<T extends any[]>(fn: (...args: T) => void): (...args: T) => void {\n  let called = false;\n  return function (...args) {\n    if (called) {\n      return;\n    }\n    called = true;\n    fn(...args);\n  };\n}\n\nexport function empty(obj: DataObject | null | undefined): boolean {\n  for (let key in obj) {\n    return false;\n  }\n  return true;\n}\n\nexport function easeInOut(v: number, a: number): number {\n  let va = pow(v, a);\n  return va / (va + pow(1 - v, a));\n}\n\nexport function easeIn(v: number, a: number): number {\n  return 2 * easeInOut(0.5 * v, a);\n}\n\nexport function easeOut(v: number, a: number): number {\n  return 2 * easeInOut(0.5 + 0.5 * v, a) - 1;\n}\n\nexport function clone<T>(obj: T): T {\n  if (!obj) { // handle undefined\n    return obj;\n  }\n  return JSON.parse(JSON.stringify(obj));\n}\n\nexport function merge<A, B>(dest: A, src: B): A & B {\n  for (let f in src) {\n    (dest as DataObject)[f] = src[f];\n  }\n  return dest as (A & B);\n}\n\nexport function has<T>(obj: T, field: string): boolean {\n  return Object.prototype.hasOwnProperty.call(obj, field);\n}\n\nexport function defaults<A, B>(dest: A, src: B): A & B {\n  for (let f in src) {\n    if (!has(dest, f)) {\n      (dest as DataObject)[f] = src[f];\n    }\n  }\n  return dest as (A & B);\n}\n\nexport function defaultsDeep<A, B>(dest: A, src: B): A & B {\n  for (let f in src) {\n    if (!has(dest, f)) {\n      (dest as DataObject)[f] = src[f];\n    } else {\n      let vd = (dest as DataObject)[f];\n      let vs = src[f];\n      if (typeof vd === 'object' && !Array.isArray(vd) && typeof vs === 'object' && !Array.isArray(vs)) {\n        defaultsDeep(vd, src[f]);\n      }\n    }\n  }\n  return dest as (A & B);\n}\n\nexport function cloneShallow<T>(src: T): T {\n  return merge({}, src);\n}\n\nexport function deepEqual(a: unknown, b: unknown): boolean {\n  if (Array.isArray(a)) {\n    if (!Array.isArray(b)) {\n      return false;\n    }\n    if (a.length !== b.length) {\n      return false;\n    }\n    for (let ii = 0; ii < a.length; ++ii) {\n      if (!deepEqual(a[ii], b[ii])) {\n        return false;\n      }\n    }\n    return true;\n  } else if (typeof a === 'object') {\n    if (typeof b !== 'object') {\n      return false;\n    }\n    if (!a || !b) { // at least one is null\n      return !a && !b; // equal if both are null\n    }\n    for (let key in a) {\n      // b must have key, or both a[key] and b[key] are undefined\n      if (!deepEqual((a as DataObject)[key], (b as DataObject)[key])) {\n        return false;\n      }\n    }\n    for (let key in b) {\n      // if b has key and it's defined, a must also be defined (and would have checked equality above)\n      if ((b as DataObject)[key] !== undefined && (a as DataObject)[key] === undefined) {\n        return false;\n      }\n    }\n    return true;\n  }\n  return a === b;\n}\n\nexport function deepAdd(dest: DataObject, src: DataObject): void {\n  assert(dest && src);\n  for (let key in src) {\n    let value = src[key];\n    let dest_value = dest[key];\n    if (typeof value === 'object') {\n      assert(value);\n      let dest_sub = (dest[key] = dest_value || {}) as DataObject;\n      assert.equal(typeof dest_sub, 'object');\n      deepAdd(dest_sub, value);\n    } else {\n      if (!dest_value) {\n        dest_value = 0;\n      }\n      assert(typeof dest_value === 'number');\n      assert(typeof value === 'number');\n      dest[key] = (dest_value || 0) + value;\n    }\n  }\n}\n\nexport function clamp(v: number, mn: number, mx: number): number {\n  return min(max(mn, v), mx);\n}\n\nexport function lerp(a: number, v0: number, v1: number): number {\n  return (1 - a) * v0 + a * v1;\n}\n\nexport function shortAngleDist(a0: number, a1: number): number {\n  let delta = (a1 - a0) % TWO_PI;\n  return 2 * delta % TWO_PI - delta;\n}\n\nexport function lerpAngle(t: number, a0: number, a1: number): number {\n  let r = a0 + shortAngleDist(a0, a1) * t;\n  if (r < 0) {\n    r += TWO_PI;\n  }\n  return r;\n}\n\n\nexport function mix(v0: number, v1: number, a: number): number { // GLSL semantics\n  return (1 - a) * v0 + a * v1;\n}\n\nexport function map01(number: number, in_min: number, in_max: number): number {\n  return (number - in_min) / (in_max - in_min);\n}\n\nexport function sign(a: number): -1 | 0 | 1 {\n  return a < 0 ? -1 : a > 0 ? 1 : 0;\n}\n\nexport function mod(a: number, n: number): number {\n  return ((a % n) + n) % n;\n}\n\n// log2 rounded up to nearest integer\nexport function log2(val: number): number {\n  for (let ii=1, jj=0; ; ii <<= 1, ++jj) {\n    if (ii >= val) {\n      return jj;\n    }\n  }\n}\n\nexport function ridx(arr: unknown[], idx: number): void {\n  arr[idx] = arr[arr.length - 1];\n  arr.pop();\n}\n\nexport function tail<T>(arr: T[]): T | null {\n  if (!arr.length) {\n    return null;\n  }\n  return arr[arr.length - 1];\n}\n\nexport function round100(a: number): number {\n  return round(a * 100) / 100;\n}\n\nexport function round1000(a: number): number {\n  return round(a * 1000) / 1000;\n}\n\nexport function fract(a: number): number {\n  return a - floor(a);\n}\n\nexport function nearSame(a: number, b: number, tol: number): boolean {\n  return abs(b - a) <= tol;\n}\n\nexport function nearSameAngle(a: number, b: number, tol: number): boolean {\n  return abs(shortAngleDist(a, b)) <= tol;\n}\n\nexport function titleCase(str: string): string {\n  return str.split(' ').map((word) => `${word[0].toUpperCase()}${word.slice(1)}`)\n    .join(' ');\n}\n\nconst EPSILON = 0.00001;\n\n// http://local.wasp.uwa.edu.au/~pbourke/geometry/sphereline/\nexport function lineCircleIntersect(p1: Vec2, p2: Vec2, pCircle: Vec2, radius: number): boolean {\n  let dp = [\n    p2[0] - p1[0],\n    p2[1] - p1[1]\n  ];\n  let a = dp[0] * dp[0] + dp[1] * dp[1];\n  let b = 2 * (dp[0] * (p1[0] - pCircle[0]) + dp[1] * (p1[1] - pCircle[1]));\n  let c = pCircle[0] * pCircle[0] + pCircle[1] * pCircle[1];\n  c += p1[0] * p1[0] + p1[1] * p1[1];\n  c -= 2 * (pCircle[0] * p1[0] + pCircle[1] * p1[1]);\n  c -= radius * radius;\n  let bb4ac = b * b - 4 * a * c;\n  if (abs(a) < EPSILON || bb4ac < 0) {\n    return false;\n  }\n\n  let mu1 = (-b + sqrt(bb4ac)) / (2 * a);\n  let mu2 = (-b - sqrt(bb4ac)) / (2 * a);\n  if (mu1 >= 0 && mu1 <= 1 || mu2 >= 0 && mu2 <= 1) {\n    return true;\n  }\n\n  return false;\n}\n\n// line segment intercept math by Paul Bourke http://paulbourke.net/geometry/pointlineplane/\nexport function lineLineIntersect(p1: Vec2, p2: Vec2, p3: Vec2, p4: Vec2): boolean {\n  let denominator = ((p4[1] - p3[1]) * (p2[0] - p1[0]) - (p4[0] - p3[0]) * (p2[1] - p1[1]));\n  let numa = ((p4[0] - p3[0]) * (p1[1] - p3[1]) - (p4[1] - p3[1]) * (p1[0] - p3[0]));\n  let numb = ((p2[0] - p1[0]) * (p1[1] - p3[1]) - (p2[1] - p1[1]) * (p1[0] - p3[0]));\n\n  if (denominator === 0) {\n    // lines are parallel, or 0-length line\n    if (!numa && !numb) {\n      // lines are coincident\n      return true;\n    }\n    return false;\n  }\n\n  let ua = numa / denominator;\n  let ub = numb / denominator;\n\n  // is the intersection along the segments\n  if (ua < 0 || ua > 1 || ub < 0 || ub > 1) {\n    return false;\n  }\n\n  return true;\n  // let x = p1[0] + ua * (p2[0] - p1[0]);\n  // let y = p1[1] + ua * (p2[1] - p1[1]);\n  // return [x, y];\n}\n\n// let setPrototypeOf = Object.setPrototypeOf ?\n//   Object.setPrototypeOf.bind() :\n//   function _setPrototypeOf(o, p) {\n//     o.__proto__ = p; // eslint-disable-line no-proto\n//     return o;\n//   };\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function inherits(ctor: Constructor | Function, superCtor: Constructor | Function): void {\n  // From Node.js\n  assert(typeof superCtor === 'function');\n  let ctor_proto_orig = ctor.prototype;\n  // not needed? ctor.super_ = superCtor; // eslint-disable-line no-underscore-dangle\n  // second parameter also not actually needed, just defines new Foo().constructor === Foo?\n  ctor.prototype = Object.create(superCtor.prototype, {\n    constructor: {\n      value: ctor,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  // If anything had been added to the prototype (only in the case of late/double\n  //   inheritance), add it\n  for (let key in ctor_proto_orig) {\n    ctor.prototype[key] = ctor_proto_orig[key];\n  }\n  // Also inherit static methods\n  // Could use setPrototypeOf (fewer ordering issues) if needed, but has strong performance warnings\n  // setPrototypeOf(ctor, superCtor);\n  for (let key in superCtor) {\n    (ctor as unknown as DataObject)[key] = (superCtor as unknown as DataObject)[key];\n  }\n}\n\nexport function isPowerOfTwo(n: number): boolean {\n  return ((n & (n - 1)) === 0);\n}\n\nexport function nextHighestPowerOfTwo(x: number): number {\n  --x;\n  for (let i = 1; i < 32; i <<= 1) {\n    x |= x >> i;\n  }\n  return x + 1;\n}\n\nexport function logdata(data: unknown): string {\n  if (data === undefined) {\n    return '';\n  }\n  let r = JSON.stringify(data);\n  if (r.length < 120) {\n    return r;\n  }\n  return `${r.slice(0, 120-3)}...(${r.length})`;\n}\n\nexport function isInteger(v: unknown): v is number /* and an integer */ {\n  return typeof v === 'number' && isFinite(v) && floor(v) === v;\n}\n\nexport function toNumber(v: string): number {\n  return Number(v);\n}\n\nexport function randomNot(not_value: number, min_value: number, max_value: number): number {\n  let new_value;\n  let range = max_value - min_value;\n  do {\n    new_value = floor(min_value + random() * range);\n  } while (new_value === not_value);\n  return new_value;\n}\n\nexport function toArray(array_like: Float32Array | Int32Array | Uint8Array): number[] {\n  return Array.prototype.slice.call(array_like);\n}\n\nexport function arrayToSet(array: number[]): Partial<Record<number, true>>;\nexport function arrayToSet(array: string[]): Partial<Record<string, true>>;\nexport function arrayToSet<T extends string | number>(array: T[]): Partial<Record<T, true>> {\n  let ret = Object.create(null);\n  for (let ii = 0; ii < array.length; ++ii) {\n    ret[array[ii]] = true;\n  }\n  return ret;\n}\n\n// Makes a prototype-less object that can safely be used as a set to query for user-supplied strings\nexport function objectToSet<V, T extends Partial<Record<string, V>>>(obj: T | undefined): T {\n  return merge(Object.create(null), obj);\n}\n\nexport function matchAll(str: string, re: RegExp): string[] {\n  let ret = [];\n  let m;\n  do {\n    m = re.exec(str);\n    if (m) {\n      ret.push(m[1]);\n    }\n  } while (m);\n  return ret;\n}\n\nexport function callEach<T extends unknown[]>(\n  arr: ((...fargs: T) => void)[] | null | undefined,\n  pre_clear?: null | undefined | boolean | never[], // `boolean` for `delete foo.cbs`\n  ...args: T\n): void {\n  if (arr && arr.length) {\n    for (let ii = 0; ii < arr.length; ++ii) {\n      arr[ii](...args);\n    }\n  }\n}\n\n// The characters cause problems with lower level systems (Google Firestore)\n// that presumably try to convert to UTF-16.\n// const utf16_surrogates = /[\\uD800-\\uDFFF]/g;\n\n// \"Bad\" whitespace characters not caught by .trim()\n// Found by running:\n//   require('somefont.json').char_infos.filter(a=>String.fromCharCode(a.c).trim()).filter(a=>!a.w).map(a=a.c)\n// const bad_whitespace = /[\\x00-\\x1F\\x7F\\u1D54\\u1D55\\u2000-\\u200F\\u205F-\\u206F\\uFE00]/g;\n\n// eslint-disable-next-line no-control-regex, no-misleading-character-class\nconst sanitize_regex = /[\\uD800-\\uDFFF\\x00-\\x1F\\x7F\\u1D54\\u1D55\\u2000-\\u200F\\u205F-\\u206F\\uFE00]/g;\nexport function sanitize(str: string): string {\n  return (str || '').replace(sanitize_regex, '');\n}\n\nexport function plural(number: number, label: string): string {\n  return `${label}${number === 1 ? '' : 's'}`;\n}\n\nexport function secondsToFriendlyString(seconds: number, force_include_seconds?: boolean): string {\n  let days = floor(seconds / (60*60*24));\n  seconds -= days * 60*60*24;\n  let hours = floor(seconds / (60*60));\n  seconds -= hours * 60*60;\n  let minutes = floor(seconds / 60);\n  seconds -= minutes * 60;\n  let resp = [];\n  if (days) {\n    let years = floor(days / 365.25);\n    if (years) {\n      days -= floor(years * 365.25);\n      resp.push(`${years} ${plural(years, 'year')}`);\n    }\n    resp.push(`${days} ${plural(days, 'day')}`);\n  }\n  if (hours) {\n    resp.push(`${hours} ${plural(hours, 'hour')}`);\n  }\n  if (minutes || !resp.length) {\n    resp.push(`${minutes} ${plural(minutes, 'minute')}`);\n  }\n  if (force_include_seconds) {\n    resp.push(`${seconds} ${plural(seconds, 'second')}`);\n  }\n  return resp.join(', ');\n}\n\nexport function secondsSince2020(): number {\n  // Seconds since Jan 1st, 2020\n  return floor(Date.now() / 1000) - 1577836800;\n}\n\nexport function dateToSafeLocaleString(date: Date, date_only: boolean, options?: {\n  weekday?: 'long' | 'short';\n  year?: 'numeric' | '2-digit';\n  month?: 'numeric' | '2-digit' | 'long' | 'short';\n  day?: 'numeric' | '2-digit';\n  hour?: 'numeric' | '2-digit';\n  minute?: 'numeric' | '2-digit';\n  second?: 'numeric' | '2-digit';\n  timeZoneName?: 'long' | 'short';\n}): string {\n  // Uses toString as a fallback since some browsers do not properly detect default locale.\n  let date_text;\n  try {\n    date_text = date_only ? date.toLocaleDateString(undefined, options) : date.toLocaleString(undefined, options);\n  } catch (e) {\n    console.error(e, '(Using toString as fallback)');\n    date_text = date_only ? date.toDateString() : date.toString();\n  }\n  return date_text;\n}\n\nexport function dateToFileTimestamp(date: Date): string {\n  function pad(value: number): string {\n    return `${value < 10 ? 0 : ''}${value}`;\n  }\n  let year = date.getFullYear();\n  let month = pad(date.getMonth() + 1);\n  let day = pad(date.getDate());\n  let hours = pad(date.getHours());\n  let minutes = pad(date.getMinutes());\n  let seconds = pad(date.getSeconds());\n  return `${year}-${month}-${day} ${hours}_${minutes}_${seconds}`;\n}\n\nexport function msToTimeString(duration: number, opts?: { hide_ms?: boolean }): string {\n  opts = opts || {};\n  let ms = duration % 1000;\n  let s;\n  let m;\n  let h;\n  s = duration - ms;\n  s %= (60 * 1000);\n  m = (duration - ms - s);\n  m %= (60 * 60 * 1000);\n  h = duration - ms - s - m;\n  h /= 60 * 60 * 1000;\n  m /= 60 * 1000;\n  s /= 1000;\n\n  return `${\n    h ? `${h}:` : ''}${\n    h && m < 10 ? '0': ''}${m}:${\n    s < 10 ? '0' : ''}${s}${\n    opts.hide_ms ? '' : `.${ms < 10 ? '00' : ms < 100 ? '0' : ''}${ms}`\n  }`;\n}\n/**\n * Returns the string with removed symbols and punctuations\n * @param {string} string String to filter out symbols\n * @returns {string} New string without symbols and punctuations\n */\nexport function removeSymbols(string: string): string {\n  return string.replace(/[.,/\\\\@#£!$%^&*;:<>{}|?=\\-+_`'\"~[\\]()]/g,'').replace(/\\s{1,}/g,' ');\n}\n\n// Stop words map\nlet sw = arrayToSet([\n  'am', 'an', 'and', 'as', 'at', 'be', 'by', 'el',\n  'for', 'in', 'is', 'la', 'las', 'los', 'of', 'on',\n  'or', 'the', 'that', 'this', 'to', 'with',\n]);\n/**\n * Removes single char and stop words from the string array.\n * @param {string[]} string_array Array of strings to filter out single char\n * @returns {string[]} Filter string array with single char and stop words removed\n */\nexport function cleanupStringArray(string_array: string[]): string[] {\n  return string_array.filter((s) => (s.length > 1) && (s.length <= 32) && !sw[s]);\n}\n\n/**\n * Return an array of the string splits after transforming to lowercase and trimming whitespaces on each of the split.\n * Punctuations and symbols are also filtered.\n * Also removes single char and stopwords via cleanupStringArray.\n * @param {string[]} string String to use to form the string split result\n * @param {string} pattern String pattern to divide the string on\n * @returns {string[]} String split result\n */\nexport function cleanStringSplit(string: string, pattern: string): string[] {\n  // remove punctuations and symbols; e.g., 'In!@£$%^&*()_+sane Wo`{}[]|/?\\'\"rld;:<>s,.' = 'Insane Worlds'\n  const base = removeSymbols(sanitize(string));\n  return cleanupStringArray(base.toLowerCase().split(pattern).map((s) => s.trim()));\n}\n\nexport function eatPossiblePromise(p: Promise<unknown> | undefined): void {\n  // On some browsers, some APIs return Promises where they did not before,\n  //   wrap in this to discard any exceptions / rejections from these.\n  //   For example, pointerLockEnter, throws \"Uncaught UnknownError\" on Chrome on\n  //   Android, as well as triggering pointerlockerror.\n  if (p && p.catch) {\n    p.catch(nop);\n  }\n}\n\nexport function errorString(e: Error | DataObject | string | unknown) : string {\n  let msg = String(e);\n  if (msg === '[object Object]') {\n    try {\n      msg = JSON.stringify(e);\n    } catch (ignored) {\n      // ignored\n    }\n  }\n  if (e && (e as Error).stack && (e as Error).message) {\n    // Error object or similar\n    // Just grabbing the message, but could do something with the stack similar to error handler in bootstrap.js\n    msg = String((e as Error).message);\n  }\n  msg = msg.slice(0, 600); // Not too huge\n  return msg;\n}\n\nexport function deprecate(exports: Partial<Record<string, unknown>>, field: string, replacement: string): void {\n  Object.defineProperty(exports, field, {\n    get: function () {\n      assert(false, `${field} is deprecated, use ${replacement} instead`);\n      return undefined;\n    }\n  });\n}\n\nlet nextTick = typeof process !== 'undefined' ?\n  process.nextTick :\n  typeof window !== 'undefined' && window.setImmediate ? window.setImmediate :\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  (fn: (...args: any[]) => void) => setTimeout(fn, 1);\n\nexport function callbackify<T>(f: () => Promise<T>): (next: ErrorCallback<T>) => void;\nexport function callbackify<T, P1>(f: (p1: P1) => Promise<T>): (p1: P1, next: ErrorCallback<T>) => void;\nexport function callbackify<T, P1, P2>(\n  f: (p1: P1, p2: P2) => Promise<T>\n): (p1: P1, p2: P2, next: ErrorCallback<T>) => void;\nexport function callbackify<T, P1, P2, P3>(\n  f: (p1: P1, p2: P2, p3: P3) => Promise<T>\n): (p1: P1, p2: P2, p3: P3, next: ErrorCallback<T>) => void;\nexport function callbackify<T, P1, P2, P3, P4>(\n  f: (p1: P1, p2: P2, p3: P3, p4: P4) => Promise<T>\n): (p1: P1, p2: P2, p3: P3, p4: P4, next: ErrorCallback<T>) => void;\n\n// Turns a promise-generating function into a callback-style function\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function callbackify(f: (...args: any[]) => Promise<unknown>): (...args: any[]) => void {\n  return function (this: unknown) {\n    let cb = arguments[arguments.length - 1]; // eslint-disable-line prefer-rest-params\n    assert.equal(typeof cb, 'function');\n    let args = Array.prototype.slice.call(arguments, 0, -1); // eslint-disable-line prefer-rest-params\n    let p = f.apply(this, args); // eslint-disable-line @typescript-eslint/no-invalid-this\n    p.then((result) => {\n      if (cb) {\n        // escape promise so it doesn't catch and re-throw the error!\n        nextTick(cb.bind(this, null, result)); // eslint-disable-line @typescript-eslint/no-invalid-this\n        cb = null;\n      }\n    }).catch((err) => {\n      if (cb) {\n        nextTick(cb.bind(this, err)); // eslint-disable-line @typescript-eslint/no-invalid-this\n        cb = null;\n      }\n    });\n  };\n}\n\n// Wraps a callback so that it escapes implicit try/catches from callbacks fired\n//   within Promises.\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function unpromisify<P extends any[], T=never>(f: (this: T, ...args: P) => void): (this: T, ...args: P) => void {\n  return function (this: T): void {\n  // eslint-disable-next-line @typescript-eslint/no-invalid-this, prefer-rest-params, @typescript-eslint/no-explicit-any\n    nextTick((f as any).apply.bind(f, this, arguments));\n  };\n}\n\nexport function msToSS2020(milliseconds: number): number {\n  // Integer seconds since Jan 1st, 2020\n  return floor(milliseconds / 1000) - 1577836800;\n}\n\nexport function ss2020ToMS(ss2020: number): number {\n  // Integer seconds since Jan 1st, 2020\n  return (ss2020 + 1577836800) * 1000;\n}\n\nconst whitespace_regex = /\\s/;\nexport function trimEnd(s: string): string {\n  let idx = s.length;\n  while (idx > 0 && s[idx-1].match(whitespace_regex)) {\n    --idx;\n  }\n  return s.slice(0, idx);\n}\n\nfunction isDigit(c: string): boolean {\n  return c >= '0' && c <= '9';\n}\n\nconst char_code_0 = '0'.charCodeAt(0);\nexport function cmpNumericSmart(a: string, b: string): number {\n  // smart compare numbers within strings\n  let ia = 0;\n  let ib = 0;\n  while (ia < a.length && ib < b.length) {\n    if (isDigit(a[ia])) {\n      if (isDigit(b[ib])) {\n        // compare numbers\n        let va = 0;\n        while (isDigit(a[ia])) {\n          va *= 10;\n          va += a.charCodeAt(ia++) - char_code_0;\n        }\n        let vb = 0;\n        while (isDigit(b[ib])) {\n          vb *= 10;\n          vb += b.charCodeAt(ib++) - char_code_0;\n        }\n        let d = va - vb;\n        if (d) {\n          return d;\n        }\n      } else {\n        // numbers before strings\n        return -1;\n      }\n    } else if (isDigit(b[ib])) {\n      return 1;\n    } else {\n      let d = a[ia].toLowerCase().charCodeAt(0) - b[ib].toLowerCase().charCodeAt(0);\n      if (d) {\n        return d;\n      }\n      ia++;\n      ib++;\n    }\n  }\n  if (ia < a.length) {\n    return 1;\n  } else if (ib < b.length) {\n    return -1;\n  } else {\n    return 0;\n  }\n}\n\nexport function mdEscape(text: string): string {\n  return text.replace(/([\\\\[*_])/g, '\\\\$1');\n}\n\ntype AsyncDictCacheInternal<T> = Partial<Record<string, {\n  in_flight?: Array<(value: T) => void>;\n  value?: T;\n}>>;\nlet async_dict_caches: Record<string, Record<never, never>> = {};\nexport function asyncDictionaryGet<T>(\n  cache_in: string | Record<never, never>, // {}\n  key: string,\n  get: (key: string, cb: (value: T) => void)=> void,\n  cb: (value: T) => void\n): void {\n  if (typeof cache_in === 'string') {\n    cache_in = async_dict_caches[cache_in] = async_dict_caches[cache_in] || {};\n  }\n  let cache = cache_in as AsyncDictCacheInternal<T>;\n  let elem = cache[key];\n  if (elem) {\n    if (elem.in_flight) {\n      elem.in_flight.push(cb);\n    } else {\n      cb(elem.value!);\n    }\n    return;\n  }\n  cache[key] = elem = {\n    in_flight: [cb],\n  };\n  get(key, function (value: T) {\n    assert(elem); // assert() is workaround TypeScript bug fixed in v5.4.0 TODO: REMOVE\n    elem.value = value;\n    callEach(elem.in_flight, elem.in_flight = undefined, value);\n  });\n}\n"]}